var preview, counter = 0, NewGalleryPics = [], oldGalleryPics = [], NewCoverPic = []; function DrowCoverPicture() { $.ajax({ url: "/Projects/LoadProjectAttachments?keyTypeId=3&projectId=" + $("#ProjectId").val(), type: "POST", success: function (e) { var t = new Image; t.style.width = "200px", t.style.height = "190px", t.style.border = "3px solid white !important", t.style.padding = "5px", t.src = "data:image/jpeg;base64," + e.images[0].attachmentFile, document.querySelector("#previewCoverFile").appendChild(t) }, error: function (e) { }, complete: function (e) { } }) } function DrowGalleryPictures() { $.ajax({ url: "/Projects/LoadProjectAttachments?keyTypeId=4&projectId=" + $("#ProjectId").val(), type: "POST", success: function (e) { for (var t = 0; t < e.images.length; t++) { oldGalleryPics.push(e.images[t]); var r = document.createElement("div"); r.setAttribute("id", "div" + e.images[t].attachmentId), r.classList.add("col-sm-3"), r.innerHTML = '<div class="success callout "><button style="color: red; background: black;" class="close-button" onclick="DeleteGalleryPic(' + e.images[t].attachmentId + ')" type="button"><span aria-hidden="true">&times;</span></button></div >'; var i = new Image; i.style.width = "200px", i.style.height = "200px", i.style.border = "3px solid white !important", i.style.padding = "5px", i.style.borderRadius = "30%", i.src = "data:image/jpeg;base64," + e.images[t].attachmentFile, r.appendChild(i), document.querySelector("#previewGalleryFiles").appendChild(r) } }, error: function (e) { }, complete: function (e) { } }) } function DeleteGalleryPic(e) { if (confirm("Are you Sure !")) { if (oldGalleryPics.length <= 1 && NewGalleryPics.length > 0) return void alert("Please Save the new picture before delete this !"); if (oldGalleryPics.length <= 1 && 0 == NewGalleryPics.length) return void alert("Can not Delete Last Image !"); $.ajax({ url: "/Projects/DeleteAttachment?attachmentId=" + e, type: "POST", success: function (t) { "OK" == t.result && (oldGalleryPics = $.grep(oldGalleryPics, function (t) { return t.attachmentId !== e }), $("#div" + e).hide(), alert("Image Deleted ")) }, error: function (e) { alert("Can Not Delete Image") }, complete: function (e) { } }) } } function DeleteNewGalleryPic(e, t) { confirm("Are you Sure !") && (NewGalleryPics = $.grep(NewGalleryPics, function (t) { return t.name !== e }), $("#div" + t).hide()) } function previewImages(e) { var t; 1 == e ? (preview = document.querySelector("#previewCoverFile"), t = document.getElementById("CoverFile").files) : (preview = document.querySelector("#previewGalleryFiles"), t = document.getElementById("GalleryFiles").files); for (var r = 0; r < t.length; r++)if (/\.(jpe?g|png|gif)$/i.test(t[r].name)) if (1 == e) CoverPic = [], readAndPreviewCover(t[r]); else { if (oldGalleryPics.length + NewGalleryPics.length >= 10) return void alert("Can Not Add More Than 10 Picture For Project !"); readAndPreviewGallery(t[r]) } else alert(t[r].name + " is not an image") } function readAndPreviewGallery(e) { var t = ++counter; if (Math.round(e.size / 1024) > 500) alert("File too Big, please select a file less than 500kb"); else { var r = new FileReader; r.addEventListener("load", function () { var r = document.createElement("div"); r.setAttribute("id", "div" + t), r.classList.add("col-sm-3"), r.innerHTML = `<div class="success callout"><button style="color: red; background: black;" class="close-button" onClick="DeleteNewGalleryPic('${e.name}', ${t})" type="button" ><span aria-hidden="true">&times;</span></button></div >`; var i = new Image; i.title = e.name, i.src = this.result, i.height > 1200 || i.width > 900 ? alert(`Sorry, this image doesn't look like the size we wanted. It's \n                        ${i.width} x ${i.height} but we require 1200 x 900 size image.`) : (NewGalleryPics.push(e), i.style.width = "200px", i.style.height = "200px", i.style.border = "3px solid white !important", i.style.padding = "5px", i.style.borderRadius = "30%", r.appendChild(i), preview.appendChild(r)) }), r.readAsDataURL(e) } } function readAndPreviewCover(e) { if (e.size / 1024 > 500) return alert("File too Big, please select a file less than 500kb"), void $("#CoverFile").val(""); var t = new FileReader; t.addEventListener("load", function () { var t = new Image; if (t.title = e.name, t.src = this.result, t.height > 900 || t.width > 900) return alert(`Sorry, this image doesn't look like the size we wanted. It's \n                        ${t.width} x ${t.height} but we require 900 x 900 size image.`), void $("#CoverFile").val(""); preview.innerHTML = "", NewCoverPic.push(e), t.height = 10, t.style.width = "150px", t.style.border = "3px solid white !important", preview.appendChild(t) }), t.readAsDataURL(e) } function SubmitFormData() { if ($("#ProjectId").val() <= 0) { if (NewCoverPic.length <= 0) return void alert("Choose At Least One Picture For Project Cover !"); if (NewGalleryPics.length <= 0) return void alert("Choose At Least One Picture For Project Gallery !") } var e = new FormData; e.append("ProjectId", $("#ProjectId").val()), e.append("ProjectTitleAr", $("#ProjectTitleAr").val()), e.append("ProjectTitleEn", $("#ProjectTitleEn").val()), e.append("ContentAr", $("#summernote2").summernote("code")), e.append("ContentEn", $("#summernote1").summernote("code")), NewGalleryPics.forEach(function (t, r) { e.append("GalleryFiles", t) }), NewCoverPic.forEach(function (t, r) { e.append("CoverFile", t) }), $("#btnSubmit").prop("disabled", !0), $.ajax({ url: "/Projects/UpdateProject", type: "POST", data: e, contentType: !1, processData: !1, success: function (e) { "OK" === e.result && (alert("Project Updated"), location.reload()) }, error: function (e) { alert("Something Went Wrong!>>>>>>>>>") }, complete: function (e) { $("#btnSubmit").prop("disabled", !1) } }) } $(document).ready(function () { $("#summernote1").summernote("code", $("#ContentEn").val()), $("#summernote2").summernote("code", $("#ContentAr").val()), $("#btnSubmit").click(function () { SubmitFormData() }), $("#ProjectId").val() > 0 && (DrowCoverPicture(), DrowGalleryPictures()) });